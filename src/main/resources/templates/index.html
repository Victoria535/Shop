<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>Shop</title>

</head>
<style>
    body {
        background: white;
    }

    #header {
        height: 50px;
    }

    .navigation {
        width: 110%;
        height: 50px;
        font-size: 16px;
        line-height: 50px;
        position: fixed;
        top: 0;
        left: -10px;
        z-index: 1000;
        background: black;
        color: #FFF;
        border-bottom: solid 1px #333;
        transition: background-color 0.2s linear;
    }

    .navigation ul {
        width: 100%;
        padding-left: 0;
        margin: 0 auto;
        display: block;
    }

    #menu li {
        float: left;
        list-style: none;
        padding: 0 25px;
    }

    #menu a {
        color: #fff;
        font-size: 19px;
        text-decoration: none;
        font-family: MS Serif;
    }

    #menu>li a:hover {
        color: red;
        transition: color 0.5s ease;
    }

    .product-wrapper {
        width: 100%;
        float: left;
        text-decoration: none;
    }

    @media only screen and (min-width: 450px) {
        .product-wrapper {
            width: 50%;
        }
    }

    @media only screen and (min-width: 768px) {
        .product-wrapper {
            width: 33.333%;
        }
    }

    @media only screen and (min-width: 1000px) {
        .product-wrapper {
            width: 25%;
        }
    }

    .product {
        display: block;
        position: relative;
        text-decoration: none;
        border: 1px solid #474747;
        border-radius: 3px;
        background: #fff;
        margin: 0 10px 0 0;
        height: 300px;
        left: -15px;
    }
    .products {
        list-style: none;
    }

    .product-photo {
        position: relative;
        padding-bottom: 100%;
        overflow: hidden;
    }

    .product-photo img {
        position: absolute;
        top: -100px;
        bottom: 0;
        left: 0;
        right: 0;
        max-width: 65%;
        max-height: 65%;
        margin: auto;
        transition: transform .4s ease-out;
    }

    .product:hover .product-photo img {
        transform: scale(1.1);
    }

    .title {
        bottom: 115px;
        text-align: center;
        position: relative;
        color: black;
        text-decoration: none;
        font-family: URW Chancery L, cursive;
        font-weight: 500;
    }

    .desc {
        bottom: 130px;
        text-align: center;
        position: relative;
        overflow: hidden;
        color: black;
        font-family: URW Chancery L, cursive;
    }

    .price {
        position: relative;
        bottom: 140px;
        left: 5px;
        width: 65px;
        height: 25px;
        color: black;
        font-size: 20px;
        font-family: "Bell MT";
        text-align: center;
        background: #ff751d;
        border-radius: 2px;
    }

    .soldbut{
        position: relative;
        bottom: 32px;
        right: -225px;
        width: 65px;
        height: 25px;
        background: url(./cart.png) no-repeat center;
        background-color: cadetblue;
        text-decoration: none;
        user-select: none;
        padding: .5em 2em;
        outline: none;
        border: 2px solid black;
        border-radius: 3px;
        transition: 0.2s;
    }
    .soldbut:hover {
        background-color: #b31206;
        transform: scale(1.1);

    }

    .input_search {
        width: 250px;
        height: 40px;
        bottom: 9px;
        padding-left: 15px;
        border-radius: 42px;
        border: 2px solid #324b4e;
        background: #F9F0DA;
        color: black;
        outline: none;
        position: relative;
        transition: .3s linear;
    }

    .searchbut {
        width: 40px;
        height: 40px;
        background: url(./search.png) no-repeat center;
        border: none;
        outline: none;
        position: relative;
        left: -50px;
        top: 5px;
    }
    .searchbut:focus {
        outline: none;
        border: 0;
    }

    .poket {
        margin-left: 62px;
    }

    .searh {
        margin-left: 280px;
    }

    .icon {
        height: 45px;
        width: 45px;
    }
    /* Боковое навигационное меню */
    .sidenav {
        height: 100%; /* 100% Full-height */
        width: 0; /* 0 ширина - изменить это с помощью JavaScript */
        position: fixed; /* Оставайтесь на месте */
        z-index: 1; /* Оставайтесь сверху */
        top: 0; /* Оставайтесь наверху */
        left: 0;
        background-color: #111; /* Фон черный*/
        overflow-x: hidden; /* Отключить горизонтальную прокрутку */
        padding-top: 60px; /* Поместите контент в 60px сверху */
        transition: 0.5s; /* 0.5 второй эффект перехода слайда в боковой навигации */
    }

    /* Ссылки меню навигации */
    .sidenav a {
        padding: 8px 8px 8px 32px;
        text-decoration: none;
        font-size: 25px;
        color: #818181;
        display: block;
        transition: 0.3s;
    }

    /* Когда вы наводите курсор мыши на навигационные ссылки, изменяется их цвет */
    .sidenav a:hover {
        color: #f1f1f1;
    }

    /* Положение и стиль кнопки закрытия (верхний правый угол) */
    .sidenav .closebtn {
        position: absolute;
        top: 50px;
        right: 25px;
        font-size: 36px;
        margin-left: 50px;
        color: white;
    }

    /* На экранах меньшего размера, где высота меньше 450px, измените стиль sidenav (меньше отступов и меньший размер шрифта) */
    @media screen and (max-height: 450px) {
        .sidenav {padding-top: 15px;}
        .sidenav a {font-size: 18px;}
    }
    .name{
        color: white;
        font-size: 18px;
    }
    .name span{
        color: red;
    }
    .acNumber{
        color: white;
        font-size: 18px;
    }
    .acNumber span{
        margin-left: 5px;
    }

    .userSpan{
        display: none;
    }

/*    Корзина*/
    .img_bucket{
        height: 45px;
        width: 45px;
    }

    a {
        text-decoration:none;
    }
    a:hover {
        text-decoration:underline;
    }

</style>

<body>

<div id="header">
    <div class="navigation">
        <ul id="menu">
            <li><img class="icon" src="icon.jpg" onclick="openNav()" alt=""></li>
            <li><a href="">Каши</a></li>
            <li><a href="">Что-то</a></li>
            <li><a href="">Сладкое</a></li>
            <li>
                <div class="searh">
                    <input id="search_field" class="input_search" type="text" placeholder="Искать здесь...">
                    <button onclick="searchByName()" type="submit" class="searchbut"></button>
                </div>
            </li>

            <li>
                    <a href="bucket.html"> Корзина </a>
            </li>

            <li sec:authorize="!isAuthenticated()"> <a href="/login">Войти</a></li>
            <li sec:authorize="isAuthenticated()"> <a th:href="@{/logout}">Выйти</a></li>
        </ul>
    </div>
</div>



<div sec:authorize="isAuthenticated()" id="mySidenav" class="sidenav">

</div>

    <ul id="productList" class="products clearfix">

    </ul>
<div>
    <ul id="userInfo" >

    </ul>
</div>
<span class="userSpan" id="usernameAuth" th:text="${#authentication.getName()}"></span>

    <script>
        /* Установите ширину боковой навигации до 250 пикселей */
        function openNav() {
            document.getElementById("mySidenav").style.width = "250px";
            infoAboutUser();
        }

        /* Установите ширину боковой навигации на 0 */
        function closeNav() {
            document.getElementById("mySidenav").style.width = "0";
        }
    function searchByName() {
        var name = document.getElementById("search_field").value;
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                var products = JSON.parse(this.responseText);
                var html= '';
                for (var i = 0; i < products.length; i++) {
                    var product = products[i];
                    console.log(product);
                    html = html +'';
                }

                document.getElementById("productList").innerHTML = html;
            }
        };
        xhttp.open("GET", "http://localhost:8080/products/search?name=" + name, true);
        xhttp.send();
    }

    function showBucket() {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                var products = JSON.parse(this.responseText);
                var html= '';
                for (var i = 0; i < products.length; i++) {
                    var bucket = products[i];
                    console.log(bucket);

                }

                document.getElementById("pocket").innerHTML = html;
            }
        };
        xhttp.open("GET", "http://localhost:8080/bucket/findAll", true);
        xhttp.send();
    }

    function loadProducts() {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                var products = JSON.parse(this.responseText);
                var html= '';
                for (var i = 0; i < products.length; i++) {
                    var product = products[i];
                    console.log(product);
                    html = html +'  <li class="product-wrapper">\n' +
                        '            <a href="" class="product">\n' +
                        '                <div class="product-photo">\n' +
                        '                    <img src="'+product.path+'" alt="">\n' +
                        '                </div>\n' +
                        '                <p class="title" >'+product.name +'</p>\n' +
                        '                <p class="desc">'+product.description+'</p>\n' +
                        '                <p class="price">'+product.cost+'</p>\n' +
                        '            </a>\n' +
                        '             <button sec:authorize="isAuthenticated()" onclick="saveToBucket('+product.id+')"  class="soldbut"></button>\n'+
                        '        </li>';
                }

                document.getElementById("productList").innerHTML = html;
            }
        };
        xhttp.open("GET", "http://localhost:8080/products/findAll", true);
        xhttp.send();
    }

    function infoAboutUser() {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                var user = JSON.parse(this.responseText);
                var html =
                    '<a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>\n ' +
                    '<p class="name">Ваше имя: <span id="username">'+user.username+'</span></p>\n' +
                    '    <p class="acNumber">Номер счета: <span><br>'+user.accountNumber+'</span></p>\n' +
                    '    <p class="name">Баланс: <span>'+user.account+'</span></p>\n' +
                    '    <input class="input_send" id="accountNumberUser"  type="text" placeholder="Введите номер счета">\n' +
                    '    <input class="input_send" id="money"  type="text" placeholder="Введите сумму, которую хотите переслать">\n' +
                    '    <button class="button_send" onclick="sendMoney()" type="submit"> Отправить </button>';
                document.getElementById("mySidenav").innerHTML = html;
            }
        };
        xhttp.open("GET", "http://localhost:8080/inset", true);
        xhttp.send();
    }

    function saveToBucket(id) {
        var xhttp = new XMLHttpRequest();

        xhttp.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                var product = JSON.parse(this.responseText);
                var name = product.name;
                var cost = product.cost;
                var description = product.description;
                var path = product.path;
                createBucket(id, name, cost, description, path);
            }
        };

        xhttp.open("GET", "http://localhost:8080/product/"+id, true);
        xhttp.send();
    }

        function createBucket(id, name, cost, description, path) {
            var xmlhttp = new XMLHttpRequest();
            xmlhttp.open("POST", "http://localhost:8080/createBucket");
            xmlhttp.setRequestHeader("Content-Type", "application/json");
            xmlhttp.send(JSON.stringify({id: id, name: name, cost: cost, description: description, path: path}));
        }

    function sendMoney() {
        var xhttp = new XMLHttpRequest();
        var number = document.getElementById("accountNumberUser").value;
        var money = document.getElementById("money").value;
        var username = document.getElementById("usernameAuth").innerHTML;
        xhttp.open("PUT", "http://localhost:8081/bank/send", true);
        xhttp.setRequestHeader("Content-Type", "application/json");
        xhttp.send(JSON.stringify({accountNumberUser: number, money: money, username:username}));
        infoAboutUser();
        }


    // infoAboutUser();
    loadProducts();
        showBucket();
</script>
</body>
</html>